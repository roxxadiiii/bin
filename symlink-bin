#!/usr/bin/env bash

# Directory containing your scripts
SCRIPT_DIR="/home/roxx/.local/bin"

# Git repository directory
REPO_DIR="/home/roxx/dev/bin"

# Function to handle Ctrl+C (SIGINT) and exit immediately
cleanup() {
    echo -e "\nScript interrupted. Exiting immediately..."
    exit 1
}

# Set trap to catch SIGINT (Ctrl+C) and call the cleanup function
trap cleanup SIGINT

# Check if Git repository directory exists
if [ ! -d "$REPO_DIR" ]; then
    echo "Git repository directory does not exist. Exiting..."
    exit 1
fi

# Change to the repository directory
cd "$REPO_DIR"

# Check if the directory is a Git repository
if [ ! -d ".git" ]; then
    echo "Directory is not a Git repository. Initializing..."
    git init
fi

# Add all scripts from SCRIPT_DIR to the repository
echo "Adding scripts from $SCRIPT_DIR to the repository..."
find "$SCRIPT_DIR" -maxdepth 1 -type f -exec ln -sf {} "$REPO_DIR" \;

# Add all files to Git
echo "Adding files to Git..."
git add .

# Commit changes
echo "Committing changes..."
git commit -m "Update scripts"

# Push changes to remote repository
echo "Pushing changes to remote repository..."
git push origin master

echo "Scripts have been synchronized with the Git repository."

